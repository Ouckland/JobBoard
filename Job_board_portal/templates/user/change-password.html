{% extends "partials/base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/change-password.css' %}">
{% endblock head %}

{% block content %}
{% include "partials/header.html" %}
<div class="change-password-container">
    <div> <!-- Added wrapper div for consistent styling -->
        <h2>Change Password</h2>
        <p>Update your account security with a new password</p>
        <form action="{% url 'users:change_password' %}" method="POST" class="change-password-form" autocomplete="off">
            {% csrf_token %}
            {% for field in form %}
                <div class="form-group {% if field.field.widget.input_type == 'password' %}password-group{% endif %}">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% if field.field.widget.input_type == "password" %}
                        <button type="button" class="toggle-password-btn" tabindex="-1" aria-label="Show password">
                            <img src="{% static 'images/eye-off.png' %}" alt="Toggle password visibility" class="toggle-password-icon">
                        </button>
                    {% endif %}
                    {% if field.help_text %}
                        <small class="form-help">{{ field.help_text }}</small>
                    {% endif %}
                    {% if field.errors %}
                        <div class="form-error">{{ field.errors.0 }}</div>
                    {% endif %}
                </div>
            {% endfor %}
            <button type="submit" class="submit-btn">Change Password</button>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtns = document.querySelectorAll('.toggle-password-btn');
    const eyeOpen = "{% static 'images/eye.png' %}";
    const eyeClosed = "{% static 'images/eye-off.png' %}";
    
    toggleBtns.forEach(function(btn) {
        const input = btn.parentElement.querySelector('input');
        const icon = btn.querySelector('.toggle-password-icon');
        
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const isPassword = input.type === "password";
            
            input.type = isPassword ? "text" : "password";
            icon.src = isPassword ? eyeOpen : eyeClosed;
            btn.setAttribute('aria-label', 
                isPassword ? 'Hide password' : 'Show password');
        });
    });
});
</script>
{% endblock content %}